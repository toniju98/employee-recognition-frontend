import{j as e,T as c,J as O,b as f,V as W,W as E,h as u,O as I,a9 as L,a1 as P,aa as _,ab as M,ac as z,ad as s,ae as k,g as D,af as q,X as F,o as G,a0 as B,p as N,ag as H,ah as $,D as K,s as V,t as X,Y,w as C,F as J,x as Q,y as U,d as y,G as Z}from"./mui-253f51e6.js";import{r as d}from"./vendor-e1e3bd03.js";import{a as g}from"./index-7063af5f.js";import{u as ee}from"./utils-ef1a3bf2.js";import{u as ae}from"./useRewardSuggestions-15ebb86f.js";import"./router-2d7623d0.js";import"./auth-01303d9d.js";function re(){const[h,m]=d.useState([]),[w,v]=d.useState([]),[p,b]=d.useState(!0),[R,j]=d.useState(null),l=async()=>{try{const{data:r}=await g.get("/rewards/organization");m(r)}catch(r){j(r instanceof Error?r:new Error("Failed to fetch organization rewards"))}},T=async()=>{try{const{data:r}=await g.get("/rewards/globalThis");v(r)}catch(r){j(r instanceof Error?r:new Error("Failed to fetch globalThis rewards"))}},S=async r=>{try{return await g.post(`/rewards/organization/add/${r}`),await l(),!0}catch(n){return console.error("Failed to add reward to organization:",n),!1}},x=async r=>{try{const n=new FormData;return Object.keys(r).forEach(i=>{i==="image"&&r.image?n.append("image",r.image):n.append(i,String(r[i]))}),await g.post("/rewards/organization",n,{headers:{"Content-Type":"multipart/form-data"}}),await l(),!0}catch(n){return console.error("Failed to create custom reward:",n),!1}},t=async(r,n)=>{try{const{data:i}=await g.patch(`/rewards/organization/${r}/status`,n);return m(h.map(a=>a._id===r?i:a)),!0}catch(i){return console.error("Failed to update reward:",i),!1}};return d.useEffect(()=>{(async()=>{b(!0);try{await Promise.all([l(),T()])}finally{b(!1)}})()},[]),{orgRewards:h,globalRewards:w,loading:p,error:R,addToOrganization:S,createCustomReward:x,updateReward:t,refreshOrgRewards:l}}function de(){const{enqueueSnackbar:h}=ee(),{orgRewards:m,globalRewards:w,loading:v,error:p,addToOrganization:b,createCustomReward:R,updateReward:j}=re();ae();const[l,T]=d.useState(0),[S,x]=d.useState(!1),[t,r]=d.useState({name:"",description:"",pointsCost:0,category:"LOCAL_PERK",quantity:1,createdBy:"6746e228c095aaa67ccae553"}),n=async a=>{await b(a)?h("Reward added to organization successfully!",{variant:"success"}):h("Failed to add reward to organization",{variant:"error"})},i=async a=>{a.preventDefault(),await R(t)?(x(!1),r({name:"",description:"",pointsCost:0,category:"LOCAL_PERK",quantity:1,createdBy:"6746e228c095aaa67ccae553"}),h("Reward created successfully!",{variant:"success"})):h("Failed to create reward",{variant:"error"})};return v?e.jsx(c,{children:"Loading..."}):p?e.jsx(c,{color:"error",children:p.message}):e.jsxs(O,{maxWidth:"lg",sx:{py:4},children:[e.jsx(f,{sx:{mb:4,background:"linear-gradient(90deg, #1976d2 0%, #1565c0 100%)",p:3,borderRadius:2,color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:e.jsx(c,{variant:"h4",component:"h1",sx:{fontWeight:600,mb:1},children:"Rewards Management"})}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider",mb:4,"& .MuiTabs-root":{minHeight:48},"& .MuiTab-root":{textTransform:"none",fontWeight:600,minHeight:48,fontSize:"1rem"}},children:e.jsxs(W,{value:l,onChange:(a,o)=>T(o),children:[e.jsx(E,{label:"Organization Rewards"}),e.jsx(E,{label:"Global Catalog"}),e.jsx(E,{label:"Suggestions"})]})}),l===0&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsx(c,{variant:"h5",sx:{fontWeight:600,color:"primary.main"},children:"Organization Rewards"}),e.jsx(u,{variant:"contained",startIcon:e.jsx(I,{}),onClick:()=>x(!0),sx:{borderRadius:2,textTransform:"none",px:3,py:1,fontWeight:600,boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:"Add Custom Reward"})]}),e.jsx(L,{component:P,sx:{borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.05)","& .MuiTableCell-root":{borderColor:"divider"}},children:e.jsxs(_,{children:[e.jsx(M,{children:e.jsxs(z,{sx:{backgroundColor:"primary.light","& .MuiTableCell-root":{color:"white",fontWeight:600}},children:[e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Points Cost"}),e.jsx(s,{children:"Category"}),e.jsx(s,{children:"Status"}),e.jsx(s,{align:"right",children:"Actions"})]})}),e.jsx(k,{children:m.map(a=>e.jsxs(z,{hover:!0,children:[e.jsx(s,{children:a.name}),e.jsx(s,{children:a.description}),e.jsx(s,{children:a.pointsCost}),e.jsx(s,{children:e.jsx(D,{label:a.category.replace("_"," ").toLowerCase(),size:"small",sx:{borderRadius:2,backgroundColor:o=>`${o.palette.primary.main}08`,color:"primary.main",fontWeight:500}})}),e.jsx(s,{children:e.jsx(q,{checked:a.isActive,onChange:()=>j(a._id,{isActive:!a.isActive}),color:"primary"})}),e.jsx(s,{align:"right",children:e.jsx(u,{variant:"outlined",size:"small",sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Edit"})})]},a._id))})]})})]}),l===1&&e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"h5",sx:{mb:4,fontWeight:600,color:"primary.main"},children:"Global Rewards Catalog"}),e.jsx(F,{container:!0,spacing:3,children:w.map(a=>e.jsx(F,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(G,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:2,transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0,0,0,0.1)"}},children:[a.image&&e.jsx(B,{component:"img",height:"200",image:a.image,alt:a.name,sx:{objectFit:"cover"}}),e.jsxs(N,{sx:{flexGrow:1,p:3},children:[e.jsx(c,{variant:"h6",sx:{fontWeight:600,color:"primary.main",mb:1},children:a.name}),e.jsx(D,{label:a.category.replace("_"," ").toLowerCase(),size:"small",sx:{mb:2,borderRadius:2,backgroundColor:o=>`${o.palette.primary.main}08`,color:"primary.main",fontWeight:500}}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a.description}),e.jsxs(c,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:[a.pointsCost," Points"]})]}),e.jsx(H,{sx:{p:2,pt:0},children:e.jsx(u,{startIcon:e.jsx($,{}),onClick:()=>n(a._id),fullWidth:!0,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:600,boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:"Add to Organization"})})]})},a._id))})]}),e.jsx(K,{open:S,onClose:()=>x(!1),children:e.jsxs("form",{onSubmit:i,children:[e.jsx(V,{children:"Add Custom Reward"}),e.jsx(X,{children:e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[e.jsx("input",{accept:"image/*",type:"file",onChange:a=>{var A;const o=(A=a.target.files)==null?void 0:A[0];o&&r({...t,image:o})},style:{display:"none"},id:"reward-image"}),e.jsx("label",{htmlFor:"reward-image",children:e.jsx(u,{variant:"outlined",component:"span",startIcon:e.jsx(Y,{}),fullWidth:!0,children:"Upload Image"})}),e.jsx(C,{label:"Name",value:t.name,onChange:a=>r({...t,name:a.target.value}),required:!0}),e.jsx(C,{label:"Description",multiline:!0,rows:3,value:t.description,onChange:a=>r({...t,description:a.target.value}),required:!0}),e.jsx(C,{type:"number",label:"Points Cost",value:t.pointsCost,onChange:a=>r({...t,pointsCost:Number(a.target.value)}),required:!0}),e.jsx(C,{type:"number",label:"Quantity Available",value:t.quantity,onChange:a=>r({...t,quantity:Number(a.target.value)}),required:!0}),e.jsxs(J,{required:!0,children:[e.jsx(Q,{children:"Category"}),e.jsxs(U,{value:t.category,label:"Category",onChange:a=>r({...t,category:a.target.value}),children:[e.jsx(y,{value:"LOCAL_PERK",children:"Local Perk"}),e.jsx(y,{value:"GIFT_CARD",children:"Gift Card"}),e.jsx(y,{value:"EXPERIENCE",children:"Experience"}),e.jsx(y,{value:"MERCHANDISE",children:"Merchandise"})]})]})]})}),e.jsxs(Z,{children:[e.jsx(u,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(u,{type:"submit",variant:"contained",children:"Create"})]})]})})]})}export{de as default};
