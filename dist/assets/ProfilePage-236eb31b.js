import{j as e,b as f,h as C,Y as I,c as F,T as i,J as D,V as A,W as R,X as l,q as W,f as L,g as E,o as M,p as O,D as B,s as N,t as U,Z as $,_ as z,$ as G,G as V}from"./mui-253f51e6.js";import{r as s}from"./vendor-e1e3bd03.js";import{b as _,a as j}from"./index-7063af5f.js";import{R as H}from"./RewardCard-9cd26ee5.js";import"./router-2d7623d0.js";import"./auth-01303d9d.js";import"./utils-ef1a3bf2.js";function q(){const[t,m]=s.useState(null),[c,g]=s.useState([]),[d,b]=s.useState([]),[p,x]=s.useState([]),[n,P]=s.useState(!0),[w,u]=s.useState(null),{updatePoints:h,fetchPoints:y}=_();return s.useEffect(()=>{(async()=>{try{const[a,o]=await Promise.all([j.get("/users/profile"),j.get("/recognition/user-data")]),k={...a.data,avatar:a.data.profileImage?`http://localhost:5000/uploads/profiles/${a.data.profileImage}`:null};m(k),h(a.data.points,a.data.allocationPoints),x(a.data.redeemedRewards),b(o.data.receivedRecognitions)}catch(a){u(a instanceof Error?a:new Error("Failed to fetch profile data"))}finally{P(!1)}})()},[]),{profile:t,achievements:c,receivedRecognitions:d,redeemedRewards:p,loading:n,error:w,updatePreferences:async r=>{try{const{data:a}=await j.patch("/users/preferences",{preferences:r});return m(o=>o?{...o,rewardPreferences:a.rewardPreferences}:null),!0}catch(a){return console.error("Failed to update preferences:",a),!1}},updateAvatar:async r=>{try{const a=new FormData;a.append("image",r);const{data:o}=await j.post("/users/profile/image",a,{headers:{"Content-Type":"multipart/form-data"}}),k=o.profileImage?await j.get(`/uploads/profiles/${o.profileImage}`,{responseType:"blob"}).then(v=>URL.createObjectURL(v.data)):null;return m(v=>v?{...v,avatar:o.profileImage?`http://localhost:5000/uploads/profiles/${o.profileImage}`:void 0}:null),!0}catch(a){return console.error("Failed to update avatar:",a),!1}}}}function J({onUploadSuccess:t,currentImage:m}){const[c,g]=s.useState(!1),d=async b=>{var x;const p=(x=b.target.files)==null?void 0:x[0];if(p){g(!0);try{await t(p)}catch(n){console.error("Failed to upload image:",n)}finally{g(!1)}}};return e.jsxs(f,{sx:{position:"relative",display:"inline-block"},children:[e.jsx("input",{accept:"image/*",type:"file",onChange:d,style:{display:"none"},id:"avatar-upload"}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsx(C,{component:"span",variant:"contained",size:"small",startIcon:e.jsx(I,{}),disabled:c,sx:{minWidth:"unset",padding:"4px 8px",borderRadius:"50%","& .MuiButton-startIcon":{margin:0}},children:c?e.jsx(F,{size:20}):e.jsx(I,{})})})]})}function ae(){const{profile:t,receivedRecognitions:m,redeemedRewards:c,loading:g,error:d,updatePreferences:b,achievements:p,updateAvatar:x}=q(),[n,P]=s.useState(0),[w,u]=s.useState(!1),[h,y]=s.useState([]);if(g)return e.jsx(F,{});if(d)return e.jsx(i,{color:"error",children:d.message});if(!t)return e.jsx(i,{children:"No profile data found"});const S=()=>{y(t.rewardPreferences),u(!0)},T=async()=>{await b(h)&&u(!1)};return e.jsxs(D,{maxWidth:"lg",sx:{py:4},children:[e.jsx(f,{sx:{mb:4,background:"linear-gradient(90deg, #1976d2 0%, #1565c0 100%)",p:3,borderRadius:2,color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:e.jsx(i,{variant:"h4",component:"h1",sx:{fontWeight:600,mb:1},children:"My Profile"})}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider",mb:4,"& .MuiTabs-root":{minHeight:48},"& .MuiTab-root":{textTransform:"none",fontWeight:600,minHeight:48,fontSize:"1rem"}},children:e.jsxs(A,{value:n,onChange:(r,a)=>P(a),children:[e.jsx(R,{label:"Profile Information"}),e.jsx(R,{label:"Preferences"}),e.jsx(R,{label:"Redeemed Rewards"})]})}),n===0&&e.jsxs(l,{container:!0,spacing:3,alignItems:"center",children:[e.jsx(l,{item:!0,children:e.jsxs(f,{sx:{position:"relative",width:120,height:120,"& .MuiAvatar-root":{border:"4px solid rgba(255,255,255,0.2)",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}},children:[e.jsx(W,{src:t.avatar,sx:{width:"100%",height:"100%"}}),e.jsx(f,{sx:{position:"absolute",bottom:-16,right:-16},children:e.jsx(J,{currentImage:t.avatar,onUploadSuccess:x})})]})}),e.jsxs(l,{item:!0,xs:!0,children:[e.jsxs(i,{variant:"h4",sx:{fontWeight:600},children:[t.firstName," ",t.lastName]}),e.jsx(i,{sx:{opacity:.8},children:t.department}),e.jsxs(L,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(E,{label:`${t.points} Personal Points`,sx:{backgroundColor:"rgba(255,255,255,0.15)",color:"white",fontWeight:600,backdropFilter:"blur(8px)"}}),e.jsx(E,{label:`${t.allocationPoints} Points to Give`,sx:{backgroundColor:"rgba(255,255,255,0.15)",color:"white",fontWeight:600,backdropFilter:"blur(8px)"}})]})]}),e.jsx(l,{item:!0,children:e.jsx(C,{variant:"contained",onClick:S,sx:{backgroundColor:"rgba(255,255,255,0.15)",backdropFilter:"blur(8px)","&:hover":{backgroundColor:"rgba(255,255,255,0.25)"}},children:"Edit Preferences"})})]}),n===1&&e.jsx(l,{container:!0,spacing:3,children:p.map(r=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(M,{children:e.jsxs(O,{children:[r.icon&&e.jsx(f,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx("img",{src:r.icon,alt:"",style:{width:64,height:64}})}),e.jsx(i,{variant:"h6",gutterBottom:!0,children:r.name}),e.jsx(i,{variant:"body2",color:"text.secondary",children:r.description}),e.jsxs(i,{variant:"caption",display:"block",sx:{mt:1},children:["Earned: ",new Date(r.earnedAt).toLocaleDateString()]})]})})},r._id))}),n===2&&e.jsx(l,{container:!0,spacing:3,children:c.map(r=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(H,{reward:r})},r._id))}),e.jsxs(B,{open:w,onClose:()=>u(!1),PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"}},children:[e.jsx(N,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider","& .MuiTypography-root":{fontSize:"1.5rem",fontWeight:600,color:"primary.main"}},children:"Reward Preferences"}),e.jsx(U,{sx:{pt:3},children:e.jsx($,{children:["FOOD","TRAVEL","ELECTRONICS","BOOKS","ENTERTAINMENT"].map(r=>e.jsx(z,{control:e.jsx(G,{checked:h.includes(r),onChange:a=>{a.target.checked?y([...h,r]):y(h.filter(o=>o!==r))},sx:{color:"primary.main","&.Mui-checked":{color:"primary.main"}}}),label:r.charAt(0)+r.slice(1).toLowerCase(),sx:{"& .MuiFormControlLabel-label":{fontSize:"1rem",color:"text.primary"}}},r))})}),e.jsxs(V,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsx(C,{onClick:()=>u(!1),variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Cancel"}),e.jsx(C,{onClick:T,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:"Save"})]})]})]})}export{ae as default};
