import{j as e,T as j,J as I,b as C,h as w,O as W,a9 as O,a1 as L,aa as U,ab as $,ac as R,ad as i,ae as q,g as Y,D as z,s as _,t as G,v as H,w as S,G as J}from"./mui-253f51e6.js";import{r as o}from"./vendor-e1e3bd03.js";import{a as d}from"./index-7063af5f.js";import{u as K}from"./utils-ef1a3bf2.js";import"./router-2d7623d0.js";import"./auth-01303d9d.js";function N(){const[x,p]=o.useState([]),[l,b]=o.useState(0),[c,u]=o.useState([]),[P,D]=o.useState([]),[A,v]=o.useState(!0),[m,h]=o.useState(null),[s,y]=o.useState({totalAllocated:0,remaining:0,monthlyBreakdown:{}}),B=async()=>{try{const{data:t}=await d.get("/users");D(t)}catch(t){console.error("Failed to fetch users:",t),h(t instanceof Error?t:new Error("Failed to fetch users"))}},T=async()=>{try{const[t,r]=await Promise.all([d.get("/admin/yearly-budget"),d.get("/admin/points-distribution")]),a=Object.entries(r.data.distributions).filter(([n,f])=>f!==null).map(([n,f])=>({employeeType:n,amount:f.monthlyAllocation}));u(a),b(t.data.budget)}catch(t){h(t instanceof Error?t:new Error("Failed to fetch points data"))}finally{v(!1)}},k=async t=>{try{const{data:r}=await d.get(`/admin/monthly-allocation/${t}`);return u(a=>[...a,{employeeType:t,amount:r.allocation}]),r.allocation}catch(r){return console.error(`Failed to fetch monthly allocation for ${t}:`,r),0}},E=async t=>{try{return await d.put("/admin/yearly-budget",{budget:t}),b(t),!0}catch(r){return console.error("Failed to set yearly budget:",r),!1}},M=async(t,r)=>{try{return await d.put("/admin/monthly-allocation",{employeeType:t,allocation:r}),u(a=>a.map(n=>n.employeeType===t?{...n,amount:r}:n)),!0}catch(a){return console.error("Failed to set monthly allocation:",a),!1}},F=async t=>{try{const{data:r}=await d.post("/admin/points/distribute",t);return p([r,...x]),!0}catch(r){return console.error("Failed to distribute points:",r),!1}},g=o.useCallback(()=>{const t={};let r=0;c.forEach(a=>{const n=a.amount*12;r+=n,t[a.employeeType]={monthly:a.amount,yearly:n,percentageOfBudget:l>0?n/l*100:0}}),y({totalAllocated:r,remaining:l-r,monthlyBreakdown:t})},[l,c]);return o.useEffect(()=>{Promise.all([T(),B()])},[]),o.useEffect(()=>{g()},[l,c,g]),{distributions:x,yearlyBudget:l,monthlyAllocations:c,users:P,loading:A,error:m,distributePoints:F,refreshDistributions:T,fetchMonthlyAllocation:k,setYearlyBudgetAmount:E,setMonthlyAllocationAmount:M,budgetCalculation:s,calculateBudget:g}}function re(){K();const{distributions:x,yearlyBudget:p,monthlyAllocations:l,users:b,loading:c,error:u,distributePoints:P,setYearlyBudgetAmount:D,setMonthlyAllocationAmount:A,budgetCalculation:v}=N(),[m,h]=o.useState(!1);return o.useState(null),o.useState({points:0,reason:""}),o.useState(p),o.useState({}),c?e.jsx(j,{children:"Loading..."}):u?e.jsx(j,{color:"error",children:u.message}):e.jsxs(I,{maxWidth:"lg",sx:{py:4},children:[e.jsx(C,{sx:{mb:4,background:"linear-gradient(90deg, #1976d2 0%, #1565c0 100%)",p:3,borderRadius:2,color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:e.jsx(j,{variant:"h4",component:"h1",sx:{fontWeight:600,mb:1},children:"Points Distribution"})}),e.jsx(C,{sx:{display:"flex",justifyContent:"flex-end",mb:3},children:e.jsx(w,{variant:"contained",startIcon:e.jsx(W,{}),onClick:()=>h(!0),sx:{borderRadius:2,textTransform:"none",px:3,py:1,fontWeight:600,boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:"Distribute Points"})}),e.jsx(O,{component:L,sx:{borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.05)","& .MuiTableCell-root":{borderColor:"divider"}},children:e.jsxs(U,{children:[e.jsx($,{children:e.jsxs(R,{sx:{backgroundColor:"primary.light","& .MuiTableCell-root":{color:"white",fontWeight:600}},children:[e.jsx(i,{children:"User"}),e.jsx(i,{children:"Department"}),e.jsx(i,{children:"Points"}),e.jsx(i,{children:"Reason"}),e.jsx(i,{children:"Date"})]})}),e.jsx(q,{children:x.map(s=>e.jsxs(R,{hover:!0,children:[e.jsx(i,{children:s.user.name}),e.jsx(i,{children:s.user.department}),e.jsx(i,{children:e.jsx(Y,{label:`${s.points} Points`,size:"small",sx:{borderRadius:2,backgroundColor:y=>`${y.palette.success.main}08`,color:"success.main",fontWeight:500}})}),e.jsx(i,{children:s.reason}),e.jsx(i,{children:new Date(s.createdAt).toLocaleDateString()})]},s._id))})]})}),e.jsxs(z,{open:m,onClose:()=>h(!1),PaperProps:{sx:{borderRadius:2,boxShadow:"0 8px 32px rgba(0,0,0,0.1)"}},children:[e.jsx(_,{sx:{pb:1,borderBottom:"1px solid",borderColor:"divider","& .MuiTypography-root":{fontSize:"1.5rem",fontWeight:600,color:"primary.main"}},children:"Distribute Points"}),e.jsx(G,{children:e.jsxs(C,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[e.jsx(H,{options:b,getOptionLabel:s=>s.name,renderInput:s=>e.jsx(S,{...s,label:"Select User",required:!0,InputProps:{...s.InputProps,sx:{borderRadius:2,"& fieldset":{borderColor:"divider"},"&:hover fieldset":{borderColor:"primary.main"}}}})}),e.jsx(S,{label:"Points",type:"number",required:!0,InputProps:{sx:{borderRadius:2,"& fieldset":{borderColor:"divider"},"&:hover fieldset":{borderColor:"primary.main"}}}}),e.jsx(S,{label:"Reason",multiline:!0,rows:3,required:!0,InputProps:{sx:{borderRadius:2,"& fieldset":{borderColor:"divider"},"&:hover fieldset":{borderColor:"primary.main"}}}})]})}),e.jsxs(J,{sx:{px:3,py:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsx(w,{onClick:()=>h(!1),variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Cancel"}),e.jsx(w,{variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:"Distribute"})]})]})]})}export{re as default};
