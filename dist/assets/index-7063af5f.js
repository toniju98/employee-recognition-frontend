import{j as e,N as I,M as K,S as U,C as F,E as A,I as H,B as q,a as M,b as C,c as S,d as k,T as P,L as G,A as Y,e as J,f as Q,g as L,h as E,P as X,i as Z,k as ee,l as te,m as oe,n as ne}from"./mui-253f51e6.js";import{c as re,r as t,a as B}from"./vendor-e1e3bd03.js";import{L as g,N as D,R as se,a as j,B as ae}from"./router-2d7623d0.js";import{K as ie}from"./auth-01303d9d.js";import{S as ce,a as le}from"./utils-ef1a3bf2.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function l(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=l(o);fetch(o.href,s)}})();var R={},T=re;R.createRoot=T.createRoot,R.hydrateRoot=T.hydrateRoot;const de="modulepreload",ue=function(n){return"/"+n},N={},y=function(r,l,c){if(!l||l.length===0)return r();const o=document.getElementsByTagName("link");return Promise.all(l.map(s=>{if(s=ue(s),s in N)return;N[s]=!0;const i=s.endsWith(".css"),x=i?'[rel="stylesheet"]':"";if(!!c)for(let a=o.length-1;a>=0;a--){const p=o[a];if(p.href===s&&(!i||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${x}`))return;const u=document.createElement("link");if(u.rel=i?"stylesheet":de,i||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),i)return new Promise((a,p)=>{u.addEventListener("load",a),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>r()).catch(s=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s})};let d=null,v=null;const z=()=>v||(typeof window>"u"?Promise.resolve(null):(v=new Promise(n=>{d?n(d):(d=new ie({url:"http://localhost:8080",realm:"employee-recognition",clientId:"employee-recognition-frontend"}),d.init({onLoad:"login-required",checkLoginIframe:!1,pkceMethod:"S256",enableLogging:!0}).then(r=>{r&&setInterval(()=>{d==null||d.updateToken(70)},6e4),n(d)}).catch(r=>{console.error("Keycloak initialization failed",r),n(null)}))}),v)),W=()=>d,he=()=>(d==null?void 0:d.token)||null,fe=()=>{d&&d.logout()},xe=async()=>{if(d)try{return await d.loadUserInfo()}catch(n){console.error("Failed to load user info",n)}return null},V=n=>{var r,l,c;return((c=(l=(r=d==null?void 0:d.tokenParsed)==null?void 0:r.realm_access)==null?void 0:l.roles)==null?void 0:c.includes(n))||!1},$=t.createContext(void 0),pe=({children:n})=>{const[r,l]=t.useState(null),[c,o]=t.useState(!1),[s,i]=t.useState(null),[x,h]=t.useState(null),[u,a]=t.useState(!1);return t.useEffect(()=>{u||z().then(p=>{p&&(l(p),o(!0),i(he()),xe().then(f=>h(f||null))),a(!0)})},[u]),e.jsx($.Provider,{value:{keycloak:r,authenticated:c,accessToken:s,userInfo:x,logout:fe,hasRole:V},children:n})},me=()=>{const n=B.useContext($);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n};function ge({children:n}){return e.jsx(ce,{maxSnack:3,children:n})}const w=le.create({baseURL:"/api",timeout:1e5,headers:{"Cache-Control":"no-cache"}});let O=!1;w.interceptors.request.use(async n=>{O||(await z(),O=!0);const r=W();if(r!=null&&r.token)try{await r.updateToken(5),n.headers.Authorization=`Bearer ${r.token}`}catch(l){console.error("Failed to refresh token",l)}return n});w.interceptors.response.use(n=>n,n=>(n.code==="ECONNREFUSED"&&console.error("Backend server is not running or not accessible at port 5000"),Promise.reject(n)));function je(){const[n,r]=t.useState([]),[l,c]=t.useState(!0),[o,s]=t.useState(null),[i,x]=t.useState([]),h=t.useCallback(async()=>{try{const{data:f}=await w.get("/notifications");r(f)}catch(f){s(f instanceof Error?f:new Error("Failed to fetch notifications"))}finally{c(!1)}},[]),u=t.useCallback(async f=>{try{return await w.patch(`/notifications/${f}/read`),r(m=>m.map(b=>b._id===f?{...b,read:!0}:b)),!0}catch(m){return console.error("Failed to mark notification as read:",m),!1}},[]),a=t.useCallback(async f=>{try{return await w.delete("/notifications",{data:{notificationIds:f}}),r(m=>m.filter(b=>!f.includes(b._id))),x([]),!0}catch(m){return console.error("Failed to delete notifications:",m),!1}},[]),p=t.useCallback(f=>{x(m=>m.includes(f)?m.filter(b=>b!==f):[...m,f])},[]);return t.useEffect(()=>{h()},[h]),{notifications:n,loading:l,error:o,markAsRead:u,refreshNotifications:h,deleteNotifications:a,selectedNotifications:i,toggleNotificationSelection:p}}const ye=t.memo(function(){const[r,l]=t.useState(null),{notifications:c,loading:o,markAsRead:s}=je(),i=t.useMemo(()=>c.filter(a=>!a.read).length,[c]),x=t.useCallback(a=>{l(a.currentTarget)},[]),h=t.useCallback(()=>{l(null)},[]),u=t.useCallback(a=>{switch(a){case"RECOGNITION":return e.jsx(A,{color:"primary"});case"REWARD":return e.jsx(F,{color:"secondary"});case"ACHIEVEMENT":return e.jsx(U,{sx:{color:"gold"}});case"POINTS":return e.jsx(K,{color:"success"});default:return e.jsx(I,{})}},[]);return e.jsxs(e.Fragment,{children:[e.jsx(H,{color:"inherit",onClick:x,children:e.jsx(q,{badgeContent:i,color:"error",children:e.jsx(I,{})})}),e.jsx(M,{anchorEl:r,open:!!r,onClose:h,PaperProps:{sx:{width:320,maxHeight:400}},children:o?e.jsx(C,{sx:{p:2,display:"flex",justifyContent:"center"},children:e.jsx(S,{size:20})}):c.length===0?e.jsx(k,{disabled:!0,children:e.jsx(P,{children:"No notifications"})}):e.jsxs(e.Fragment,{children:[c.slice(0,5).map(a=>e.jsxs(k,{component:g,to:"/notifications",onClick:()=>{a.read||s(a._id),h()},sx:{whiteSpace:"normal",py:1},children:[e.jsx(G,{children:u(a.type)}),e.jsxs(C,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(P,{variant:"subtitle2",sx:{fontWeight:a.read?400:600},children:a.title}),e.jsx(P,{variant:"caption",color:"text.secondary",children:new Date(a.createdAt).toLocaleString()})]})]},a._id)),e.jsx(k,{component:g,to:"/notifications",onClick:h,sx:{justifyContent:"center",color:"primary.main"},children:e.jsx(P,{children:"View All"})})]})})]})});function be(){const[n,r]=t.useState(0),[l,c]=t.useState(0),[o,s]=t.useState(!0),[i,x]=t.useState(null),h=async()=>{try{const{data:a}=await w.get("/users/points");r(a.personal),c(a.allocation)}catch(a){x(a instanceof Error?a:new Error("Failed to fetch points"))}finally{s(!1)}};return t.useEffect(()=>{h()},[]),{points:n,allocationPoints:l,loading:o,error:i,updatePoints:(a,p)=>{r(a),p!==void 0&&c(p)},fetchPoints:h}}function ke(){const{authenticated:n,logout:r,hasRole:l}=me(),[c,o]=t.useState(null),s=l("admin"),{points:i,allocationPoints:x,loading:h}=be();return e.jsx(Y,{position:"static",sx:{background:"linear-gradient(90deg, #1976d2 0%, #1565c0 100%)",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:e.jsxs(J,{children:[e.jsxs(P,{variant:"h6",component:g,to:"/",sx:{textDecoration:"none",color:"white",flexGrow:1,display:"flex",alignItems:"center",gap:1,fontWeight:600},children:[e.jsx(A,{sx:{color:"#FFD700"}})," Recognition"]}),e.jsx(C,{sx:{display:"flex",gap:2,alignItems:"center"},children:n&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsxs(Q,{direction:"row",spacing:1,children:[e.jsx(L,{label:h?"Loading...":`${i} Points`,color:"secondary",sx:{backgroundColor:"rgba(255,255,255,0.15)",color:"white","& .MuiChip-label":{fontWeight:600},backdropFilter:"blur(8px)"}}),e.jsx(L,{label:h?"Loading...":`${x} to Give`,color:"secondary",sx:{backgroundColor:"rgba(255,255,255,0.15)",color:"white","& .MuiChip-label":{fontWeight:600},backdropFilter:"blur(8px)"}})]}),e.jsx(E,{component:g,to:"/dashboard",startIcon:e.jsx(A,{sx:{color:"#FFD700"}}),sx:{color:"white","&:hover":{backgroundColor:"rgba(255,255,255,0.1)"}},children:"Feed"}),e.jsx(E,{component:g,to:"/profile",startIcon:e.jsx(X,{}),sx:{color:"white","&:hover":{backgroundColor:"rgba(255,255,255,0.1)"}},children:"Profile"}),e.jsx(E,{component:g,to:"/rewards",startIcon:e.jsx(F,{}),sx:{color:"white","&:hover":{backgroundColor:"rgba(255,255,255,0.1)"}},children:"Rewards"}),s&&e.jsx(E,{color:"inherit",startIcon:e.jsx(Z,{}),onClick:u=>o(u.currentTarget),sx:{color:"white","&:hover":{backgroundColor:"rgba(255,255,255,0.1)"}},children:"Admin"}),e.jsx(E,{startIcon:e.jsx(ee,{}),onClick:r,sx:{color:"white","&:hover":{backgroundColor:"rgba(255,255,255,0.1)"}},children:"Logout"})]})}),e.jsxs(M,{anchorEl:c,open:!!c,onClose:()=>o(null),children:[e.jsx(k,{component:g,to:"/admin/recognition-types",onClick:()=>o(null),children:"Recognition Types"}),e.jsx(k,{component:g,to:"/admin/rewards",onClick:()=>o(null),children:"Rewards Management"}),e.jsx(k,{component:g,to:"/admin/points",onClick:()=>o(null),children:"Points Distribution"}),e.jsx(k,{component:g,to:"/admin/analytics",onClick:()=>o(null),children:"Analytics"})]})]})})}function _({children:n}){const[r,l]=t.useState(!0),[c,o]=t.useState(!1);return t.useEffect(()=>{(async()=>{try{const i=await W();i&&i.authenticated?o(V("admin")):o(!1)}catch(i){console.error("Admin role check failed:",i),o(!1)}finally{l(!1)}})()},[]),r?e.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:e.jsx(S,{})}):c?e.jsx(e.Fragment,{children:n}):e.jsx(D,{to:"/dashboard",replace:!0})}const we=t.lazy(()=>y(()=>import("./DashboardPage-855fc57a.js"),["assets/DashboardPage-855fc57a.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/utils-ef1a3bf2.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js"])),Ee=t.lazy(()=>y(()=>import("./RewardsPage-12497f6c.js"),["assets/RewardsPage-12497f6c.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/RewardCard-9cd26ee5.js","assets/utils-ef1a3bf2.js","assets/useRewardSuggestions-15ebb86f.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js"])),Pe=t.lazy(()=>y(()=>import("./ProfilePage-236eb31b.js"),["assets/ProfilePage-236eb31b.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/RewardCard-9cd26ee5.js","assets/utils-ef1a3bf2.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js"])),Ce=t.lazy(()=>y(()=>import("./NotificationsPage-5359ad1d.js"),["assets/NotificationsPage-5359ad1d.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/utils-ef1a3bf2.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js"])),ve=t.lazy(()=>y(()=>import("./AdminAnalyticsPage-b80203e3.js"),["assets/AdminAnalyticsPage-b80203e3.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js","assets/utils-ef1a3bf2.js"])),_e=t.lazy(()=>y(()=>import("./AdminPointsPage-6f4a5feb.js"),["assets/AdminPointsPage-6f4a5feb.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/utils-ef1a3bf2.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js"])),Ae=t.lazy(()=>y(()=>import("./AdminRecognitionTypesPage-dcbe3ae0.js"),["assets/AdminRecognitionTypesPage-dcbe3ae0.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js","assets/utils-ef1a3bf2.js"])),Re=t.lazy(()=>y(()=>import("./AdminRewardsPage-ae6907c7.js"),["assets/AdminRewardsPage-ae6907c7.js","assets/mui-253f51e6.js","assets/vendor-e1e3bd03.js","assets/utils-ef1a3bf2.js","assets/useRewardSuggestions-15ebb86f.js","assets/router-2d7623d0.js","assets/auth-01303d9d.js"])),Se=()=>e.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:e.jsx(S,{})});function Ie(){return e.jsx(ge,{children:e.jsxs(pe,{children:[e.jsx(ke,{}),e.jsx("main",{children:e.jsx(t.Suspense,{fallback:e.jsx(Se,{}),children:e.jsxs(se,{children:[e.jsx(j,{path:"/",element:e.jsx(D,{to:"/dashboard",replace:!0})}),e.jsx(j,{path:"/dashboard",element:e.jsx(we,{})}),e.jsx(j,{path:"/rewards",element:e.jsx(Ee,{})}),e.jsx(j,{path:"/profile",element:e.jsx(Pe,{})}),e.jsx(j,{path:"/notifications",element:e.jsx(Ce,{})}),e.jsx(j,{path:"/admin/analytics",element:e.jsx(_,{children:e.jsx(ve,{})})}),e.jsx(j,{path:"/admin/points",element:e.jsx(_,{children:e.jsx(_e,{})})}),e.jsx(j,{path:"/admin/recognition-types",element:e.jsx(_,{children:e.jsx(Ae,{})})}),e.jsx(j,{path:"/admin/rewards",element:e.jsx(_,{children:e.jsx(Re,{})})})]})})})]})})}const Le=te({palette:{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2"},background:{default:"#f5f7fa",paper:"#ffffff"},text:{primary:"#2d3748",secondary:"#718096"}},components:{MuiCard:{styleOverrides:{root:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)",transition:"all 0.3s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0,0,0,0.1)"}}}},MuiButton:{styleOverrides:{root:{borderRadius:8,textTransform:"none",fontWeight:600,padding:"8px 16px"},contained:{boxShadow:"none","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}}}},MuiChip:{styleOverrides:{root:{borderRadius:8,fontWeight:500}}},MuiAvatar:{styleOverrides:{root:{border:"2px solid #ffffff",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:8}}}}},shape:{borderRadius:8},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontWeight:700},h2:{fontWeight:700},h3:{fontWeight:600},h4:{fontWeight:600},h5:{fontWeight:600},h6:{fontWeight:600},button:{fontWeight:600}}});R.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(ae,{children:e.jsxs(oe,{theme:Le,children:[e.jsx(ne,{}),e.jsx(Ie,{})]})})}));export{w as a,be as b,je as c,me as u};
